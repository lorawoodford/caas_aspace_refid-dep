name: Diff views

on: push

jobs:
  diff:
    runs-on: ubuntu-latest
    steps:
    - name: Get tag
      id: get_tag_name
      run: echo ::set-output name=VERSION::${GITHUB_REF/refs/v2.2.0/}

    - name: Checkout current plugin
      uses: actions/checkout@v4
      with:
        path: plugin
        sparse-checkout: |
          frontend/views

    - name: Checkout ArchivesSpace repo
      uses: actions/checkout@v4
      with:
        # fetch-depth: 0
        # fetch-tags: true
        ref: ${{ steps.get_tag_name.outputs.VERSION }}
        repository: lorawoodford/archivesspace
        path: archivesspace
        sparse-checkout: |
          frontend/app/views

    - name: Get diff
      run: echo "::set-output name=git-diff::$(git diff --diff-filter=M -w -- ${{ github.workspace }}/plugin/frontend/views ${{ github.workspace }}/archivesspace/frontend/app/views)"
